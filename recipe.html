<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe - Recipe Manager</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Recipe Manager</h1>
            <a href="index.html" class="btn back-btn">‚Üê Back to Recipes</a>
        </header>

        <main>
            <div class="recipe-content">
                <div class="recipe-header">
                    <div></div>
                    <div>
                        <button id="editBtn" class="btn btn-secondary">‚úèÔ∏è Edit Recipe</button>
                        <button id="deleteBtn" class="btn btn-danger">üóëÔ∏è Delete Recipe</button>
                    </div>
                </div>

                <div id="loading" class="loading">üìñ Loading recipe...</div>
                <div id="error" class="error" style="display: none;"></div>
                <div id="recipeContent" style="display: none;">
                    <div id="recipeBody" class="recipe-body"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="github.js"></script>
    <script>
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const recipeContent = document.getElementById('recipeContent');
        const recipeBody = document.getElementById('recipeBody');
        const editBtn = document.getElementById('editBtn');
        const deleteBtn = document.getElementById('deleteBtn');

        let currentFilename = null;

        // Get filename from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        currentFilename = urlParams.get('file');

        if (!currentFilename) {
            showError('No recipe file specified');
        } else {
            loadRecipe();
        }

        // Event listeners
        editBtn.addEventListener('click', () => {
            window.location.href = `editor.html?file=${encodeURIComponent(currentFilename)}`;
        });

        deleteBtn.addEventListener('click', async () => {
            if (confirm('Are you sure you want to delete this recipe? This action cannot be undone.')) {
                try {
                    loading.style.display = 'block';
                    recipeContent.style.display = 'none';
                    
                    await GitHubAPI.deleteRecipe(currentFilename);
                    alert('Recipe deleted successfully!');
                    window.location.href = 'index.html';
                } catch (err) {
                    showError('Failed to delete recipe: ' + err.message);
                    loading.style.display = 'none';
                    recipeContent.style.display = 'block';
                }
            }
        });

        async function loadRecipe() {
            loading.style.display = 'block';
            error.style.display = 'none';
            recipeContent.style.display = 'none';

            try {
                const content = await GitHubAPI.getRecipe(currentFilename);
                displayRecipe(content);
            } catch (err) {
                showError('Failed to load recipe: ' + err.message);
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayRecipe(markdown) {
            // Configure marked options
            marked.setOptions({
                breaks: true,
                gfm: true
            });

            // Render markdown to HTML
            const html = marked.parse(markdown);
            recipeBody.innerHTML = html;
            
            // Update page title
            const title = GitHubAPI.extractTitleFromContent(markdown) || GitHubAPI.extractTitleFromFilename(currentFilename);
            document.title = `${title} - Recipe Manager`;
            
            recipeContent.style.display = 'block';
        }

        function showError(message) {
            error.textContent = message;
            error.style.display = 'block';
        }
    </script>
</body>
</html>
